<!doctype html>
<html lang="ru" data-bs-theme="light">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>GEKTO Tech - Login</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fontsource/source-sans-3@5.0.12/index.css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css" />
  <link rel="stylesheet" href="/assets/adminlte.min.css" />
  <style>
    .login-page {
      min-height: 100vh;
      background:
        radial-gradient(1000px 500px at -10% -30%, rgba(13, 110, 253, 0.22), transparent 55%),
        radial-gradient(900px 400px at 120% 130%, rgba(25, 135, 84, 0.16), transparent 55%),
        var(--bs-body-bg);
    }
    .login-box { width: min(94vw, 420px); }
    .control-row { display: flex; gap: .5rem; justify-content: space-between; margin-bottom: .75rem; }
    .control-row .btn-group { flex-wrap: nowrap; }
  </style>
</head>
<body class="login-page">
  <div class="login-box">
    <div class="card card-outline card-primary shadow">
      <div class="card-header text-center py-3">
        <a href="#" class="h3 mb-0"><b>GEKTO</b> Tech</a>
      </div>
      <div class="card-body">
        <div class="control-row">
          <div class="btn-group btn-group-sm" role="group" aria-label="Language">
            <button class="btn btn-outline-secondary" data-lang="ru">RU</button>
            <button class="btn btn-outline-secondary" data-lang="uz">UZ</button>
            <button class="btn btn-outline-secondary" data-lang="en">EN</button>
          </div>
          <div class="btn-group btn-group-sm" role="group" aria-label="Theme">
            <button class="btn btn-outline-secondary" data-theme="light"><i class="bi bi-sun"></i></button>
            <button class="btn btn-outline-secondary" data-theme="dark"><i class="bi bi-moon"></i></button>
          </div>
        </div>

        <p class="login-box-msg mb-3" id="subtitle">Войдите, чтобы продолжить</p>

        <form id="loginForm">
          <div class="input-group mb-3">
            <input id="email" type="email" class="form-control" placeholder="Email" autocomplete="username" required />
            <div class="input-group-text"><span class="bi bi-envelope"></span></div>
          </div>
          <div class="input-group mb-3">
            <input id="password" type="password" class="form-control" placeholder="Password" autocomplete="current-password" required />
            <div class="input-group-text"><span class="bi bi-lock-fill"></span></div>
          </div>
          <div class="d-grid">
            <button class="btn btn-primary" id="submitBtn" type="submit">Войти</button>
          </div>
          <div id="msg" class="small mt-3 text-danger"></div>
        </form>
      </div>
    </div>
  </div>

  <script>
    const API_BASE = "https://api.tech.gekto.uz";
    const I18N = {
      ru: { subtitle: "Войдите, чтобы продолжить", submit: "Войти", err: "Ошибка", invalid: "Неверный логин или пароль" },
      uz: { subtitle: "Davom etish uchun tizimga kiring", submit: "Kirish", err: "Xato", invalid: "Login yoki parol noto'g'ri" },
      en: { subtitle: "Sign in to continue", submit: "Sign in", err: "Error", invalid: "Invalid email or password" }
    };

    const html = document.documentElement;
    const lang = localStorage.getItem("tech_lang") || "ru";
    const theme = localStorage.getItem("tech_theme") || "light";
    html.lang = lang;
    html.setAttribute("data-bs-theme", theme);

    function t(key) {
      const l = html.lang || "ru";
      return (I18N[l] && I18N[l][key]) || I18N.ru[key] || key;
    }

    function paint() {
      document.getElementById("subtitle").textContent = t("subtitle");
      document.getElementById("submitBtn").textContent = t("submit");
      document.querySelectorAll("[data-lang]").forEach(b => {
        b.classList.toggle("btn-secondary", b.dataset.lang === html.lang);
        b.classList.toggle("btn-outline-secondary", b.dataset.lang !== html.lang);
      });
      document.querySelectorAll("[data-theme]").forEach(b => {
        b.classList.toggle("btn-secondary", b.dataset.theme === html.getAttribute("data-bs-theme"));
        b.classList.toggle("btn-outline-secondary", b.dataset.theme !== html.getAttribute("data-bs-theme"));
      });
    }

    paint();

    document.querySelectorAll("[data-lang]").forEach(btn => {
      btn.addEventListener("click", () => {
        html.lang = btn.dataset.lang;
        localStorage.setItem("tech_lang", btn.dataset.lang);
        paint();
      });
    });

    document.querySelectorAll("[data-theme]").forEach(btn => {
      btn.addEventListener("click", () => {
        html.setAttribute("data-bs-theme", btn.dataset.theme);
        localStorage.setItem("tech_theme", btn.dataset.theme);
        paint();
      });
    });

    document.getElementById("loginForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      const msgEl = document.getElementById("msg");
      msgEl.textContent = "";
      try {
        const r = await fetch(API_BASE + "/auth/login", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            email: document.getElementById("email").value.trim(),
            password: document.getElementById("password").value
          })
        });
        const data = await r.json().catch(() => ({}));
        if (!r.ok || !data.ok || !data.token) {
          msgEl.textContent = data.error || t("invalid");
          return;
        }
        localStorage.setItem("tech_token", data.token);
        location.href = "/main.html";
      } catch (err) {
        msgEl.textContent = `${t("err")}: ${err?.message || err}`;
      }
    });
  </script>
</body>
</html>
